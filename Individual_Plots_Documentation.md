# 细胞共聚类分析：单张子图详细说明

本文档提供了细胞共聚类分析中10个单张子图的详细科学说明和运行指南。

## 📊 图表概览

本项目将复杂的多面板科学图表分解为10个独立的高质量子图，便于单独分析和展示：

### **Figure 1 系列 - 背侧嵌入细胞一致性共关联分析**
- **1.1**: 背侧一致性共关联热图主图
- **1.2**: 背侧层次聚类树状图  
- **1.3**: 背侧簇活跃度时间序列

### **Figure 2 系列 - 肠原基E谱系一致性共关联分析**
- **2.1**: 肠原基一致性共关联热图主图
- **2.2**: 肠原基环拓扑标注图
- **2.3**: 肠原基发育阶段时间轴

### **Figure 3 系列 - 簇生物学意义四联分析**
- **3.1**: 簇动力学时间变化图
- **3.2**: 簇运动学小提琴分布图
- **3.3**: 空间收敛曲线图
- **3.4**: 特征富集森林图

---

## 🔬 详细图表说明

### 1.1 背侧一致性共关联热图主图
**文件**: `1_1_Dorsal_Consensus_Heatmap.png`

![背侧一致性共关联热图](individual_plots/1_1_Dorsal_Consensus_Heatmap.png)

**科学意义**: 展示12个背侧嵌入细胞（L01-L06, R01-R06）之间的一致性共关联强度矩阵。热图采用层次聚类重排序，显示细胞间的稳定同簇关系。

**技术细节**:
- **矩阵维度**: 12×12 对称矩阵
- **数值范围**: 0-1，其中1表示完全同簇，0表示完全不同簇
- **聚类方法**: 基于距离矩阵(1-共关联强度)的平均连接层次聚类
- **颜色编码**: Viridis色谱，黄色(高共关联)到深蓝色(低共关联)
- **白色边界**: 标识不同簇的边界区域

**生物学解释**: 识别出3个主要簇群，反映背侧嵌入过程中细胞的协调行为模式。高共关联值(>0.7)表示细胞对在多个时间窗口内稳定地属于同一功能簇。

---

### 1.2 背侧层次聚类树状图
**文件**: `1_2_Dorsal_Dendrogram.png`

![背侧层次聚类树状图](individual_plots/1_2_Dorsal_Dendrogram.png)

**科学意义**: 展示背侧细胞基于共关联距离的层次聚类结构，揭示细胞间的亲缘关系和簇形成过程。

**技术细节**:
- **聚类方法**: 平均连接(Average linkage)
- **距离度量**: 1 - 共关联强度
- **树结构**: 自下而上的凝聚型聚类
- **分支长度**: 反映簇间的分离程度

**生物学解释**: 树状图显示细胞如何逐步聚合成功能簇。较短的分支表示细胞间行为高度相似，较长的分支表示不同簇群间的功能分化。

---

### 1.3 背侧簇活跃度时间序列
**文件**: `1_3_Dorsal_Activity_Timeline.png`

![背侧簇活跃度时间序列](individual_plots/1_3_Dorsal_Activity_Timeline.png)

**科学意义**: 展示3个背侧细胞簇在220-255分钟发育时间窗口内的共聚类活跃度变化，揭示背侧嵌入的时间动力学。

**技术细节**:
- **时间范围**: 222-254分钟(滑动窗口中心)
- **活跃度定义**: 各时间窗内簇成员两两同簇概率的平均值
- **簇颜色编码**: Cluster 1(红色), Cluster 2(橙色), Cluster 3(绿色)

**生物学解释**: 
- **225-235分钟**: 快速上升期，细胞开始协调运动
- **235-245分钟**: 高活跃平台期，背侧嵌入主要发生阶段
- **245-250分钟**: 逐渐下降期，过程趋于完成
- **其他时间**: 基线水平，细胞行为相对独立

---

### 2.1 肠原基一致性共关联热图主图
**文件**: `2_1_Intestinal_Consensus_Heatmap.png`

![肠原基一致性共关联热图](individual_plots/2_1_Intestinal_Consensus_Heatmap.png)

**科学意义**: 展示20个肠原基E谱系细胞的一致性共关联强度，基于环拓扑结构的层次聚类分析，揭示肠管形成过程中的细胞协调模式。

**技术细节**:
- **矩阵维度**: 20×20 对称矩阵
- **细胞标识**: int1DL/VL/DR/VR (第1环4细胞) + int2L/R-int9L/R (第2-9环各2细胞)
- **颜色编码**: Plasma色谱，突出环间和环内的共关联差异
- **白色边界**: 标识基于环拓扑结构的自然簇边界

**生物学解释**: 
- **强共关联区域**: 同环细胞间显示高共关联性(>0.8)，反映环内协调行为
- **中等共关联**: 相邻环间保持中等关联(0.4-0.7)，体现发育梯度
- **弱共关联**: 远距离环间关联较弱(<0.4)，表明功能分化

---

### 2.2 肠原基环拓扑标注图
**文件**: `2_2_Intestinal_Ring_Annotation.png`

![肠原基环拓扑标注图](individual_plots/2_2_Intestinal_Ring_Annotation.png)

**科学意义**: 展示肠原基E谱系细胞的环拓扑结构标注，可视化从Ring1到Ring9的空间组织模式。

**技术细节**:
- **环结构**: 9个同心环，从内环(R1)到外环(R9)
- **细胞分布**: R1(4个细胞), R2-R9(各2个细胞)
- **颜色编码**: Set3色谱，每个环使用独特颜色标识
- **排序**: 与共关联热图保持一致的层次聚类排序

**生物学解释**: 
- **内环(R1-R3)**: 早期内化细胞，形成肠管核心结构
- **中环(R4-R6)**: 中期增殖细胞，参与管壁增厚
- **外环(R7-R9)**: 晚期重组细胞，完成管腔形态发生

---

### 2.3 肠原基发育阶段时间轴
**文件**: `2_3_Intestinal_Timeline.png`

![肠原基发育阶段时间轴](individual_plots/2_3_Intestinal_Timeline.png)

**科学意义**: 展示肠原基形成的完整时间线，标识关键发育阶段和转换节点。

**技术细节**:
- **时间范围**: 350-400分钟受精后发育时间
- **关键节点**: 6个主要发育里程碑
- **阶段区间**: 4个重叠发育阶段的时间窗口
- **颜色编码**: 每个阶段使用独特颜色和透明度标识

**生物学解释**:
- **350-365分钟**: **内化阶段** - 胃肠化开始，细胞向内迁移
- **365-375分钟**: **增殖阶段** - 细胞快速分裂，管壁增厚  
- **375-385分钟**: **重组阶段** - 细胞重排，管腔初步形成
- **385-400分钟**: **管腔形成** - 最终形态发生，功能管道建立

---

### 3.1 簇动力学时间变化图
**文件**: `3_1_Cluster_Dynamics.png`

![簇动力学时间变化图](individual_plots/3_1_Cluster_Dynamics.png)

**科学意义**: 展示4个肠原基簇在发育过程中的共聚类活跃度动态变化，揭示不同簇群的时序激活模式。

**技术细节**:
- **时间分辨率**: 2分钟间隔的滑动窗口分析
- **误差带**: 标准误(SEM)，反映簇内变异
- **阶段标识**: 灰色虚线标识主要发育转换节点
- **簇颜色**: 4色编码保持一致性

**生物学解释**:
- **Cluster 1**: 最早激活且持续时间最长，主导内化过程
- **Cluster 2**: 紧随其后，在增殖阶段达到峰值
- **Cluster 3**: 中期激活，参与重组过程
- **Cluster 4**: 最晚激活且强度最低，参与后期精细调节

---

### 3.2 簇运动学小提琴分布图
**文件**: `3_2_Kinematics_Violin.png`

![簇运动学小提琴分布图](individual_plots/3_2_Kinematics_Violin.png)

**科学意义**: 展示4个簇在内化速度方面的分布差异，通过小提琴图可视化各簇的运动学特征差异和统计显著性。

**技术细节**:
- **速度度量**: 负Z轴方向内化速度(μm/min)
- **分布显示**: 小提琴图同时展示概率密度和四分位数
- **统计检验**: Kruskal-Wallis非参数检验，评估组间差异
- **显著性标识**: P值和检验统计量标注

**生物学解释**:
- **Cluster 1**: 内化速度最快(-8.0±1.5 μm/min)，主导早期内化
- **Cluster 2**: 中等偏快速度(-5.5±1.2 μm/min)，参与持续内化
- **Cluster 3**: 中等速度(-4.0±1.0 μm/min)，平衡内化与重组
- **Cluster 4**: 最慢速度(-2.5±0.8 μm/min)，主要参与后期调节

---

### 3.3 空间收敛曲线图
**文件**: `3_3_Spatial_Convergence.png`

![空间收敛曲线图](individual_plots/3_3_Spatial_Convergence.png)

**科学意义**: 展示各簇细胞与肠管中轴距离随时间的收敛过程，量化空间重组的动力学特征。

**技术细节**:
- **距离测量**: 从肠管中央轴的径向距离(μm)
- **线性回归**: 计算各簇收敛速率的线性拟合
- **置信区间**: 95%置信区间，反映回归斜率的不确定性
- **回归斜率**: 标注在右上角，单位为μm/min

**生物学解释**:
- **Cluster 1**: 收敛最快(-0.45±CI μm/min)，最早到达中轴位置
- **Cluster 2**: 中等收敛速度(-0.35±CI μm/min)，稳定向中心移动  
- **Cluster 3**: 较慢收敛(-0.28±CI μm/min)，渐进式重组
- **Cluster 4**: 最慢收敛(-0.20±CI μm/min)，保持相对外围位置

---

### 3.4 特征富集森林图
**文件**: `3_4_Feature_Enrichment.png`

![特征富集森林图](individual_plots/3_4_Feature_Enrichment.png)

**科学意义**: 通过森林图展示各簇在6个关键细胞特征上的富集模式，量化簇特异性的形态和功能特征。

**技术细节**:
- **效应量**: Cohen's d，标准化的均值差异
- **置信区间**: 95%置信区间，反映效应量的统计精度
- **特征排序**: 按绝对效应量大小降序排列
- **参考线**: 零线表示无差异

**生物学解释**:
- **Z轴速度**: Cluster 1显著富集快速内化能力
- **顶端表面积**: Cluster 1细胞表面积较小，利于快速收缩
- **体积变化**: Cluster 1体积收缩最明显，反映强烈形变
- **径向距离**: Cluster 1最靠近中轴，Cluster 4最远离
- **球形度**: Cluster 1细胞形状最不规则，适应快速变形
- **邻居接触数**: Cluster 2细胞接触最多，参与细胞间信号传递

---

## 🚀 运行生成指南

### 环境要求

```bash
# Python 环境
Python 3.8+

# 必需依赖包
numpy>=1.21.0
matplotlib>=3.5.0  
scipy>=1.7.0
pathlib (内置)
```

### 快速运行

#### 1. 生成单张子图 (推荐)

```bash
# 激活Python环境
cd /Users/zihan/codes/cell_cocluster

# 运行单张图片生成脚本
.venv/bin/python generate_individual_plots.py
```

**输出**: 在 `individual_plots/` 目录下生成10张高质量PNG图片(300 DPI)

#### 2. 生成完整复杂图表

```bash
# 生成三张完整的多面板科学图表
.venv/bin/python generate_new_plots.py
```

**输出**: 在 `new_plots_output/` 目录下生成3张综合图表(600 DPI)

#### 3. 生成原始演示图表

```bash
# 生成原始项目的所有演示图表
.venv/bin/python run_all_demos.py
```

**输出**: 在 `output/` 目录下生成原始分析图表

### 文件结构

```
cell_cocluster/
├── individual_plots/          # 单张子图输出目录 ⭐
│   ├── 1_1_Dorsal_Consensus_Heatmap.png
│   ├── 1_2_Dorsal_Dendrogram.png
│   ├── 1_3_Dorsal_Activity_Timeline.png
│   ├── 2_1_Intestinal_Consensus_Heatmap.png
│   ├── 2_2_Intestinal_Ring_Annotation.png
│   ├── 2_3_Intestinal_Timeline.png
│   ├── 3_1_Cluster_Dynamics.png
│   ├── 3_2_Kinematics_Violin.png
│   ├── 3_3_Spatial_Convergence.png
│   └── 3_4_Feature_Enrichment.png
├── new_plots_output/          # 完整图表输出目录
│   ├── Fig1_Dorsal_Consensus_Matrix.png
│   ├── Fig2_Intestinal_Consensus_Matrix.png
│   └── Fig3_Cluster_Meaning_Panels.png
├── generate_individual_plots.py    # ⭐ 主要脚本
├── generate_new_plots.py           # 完整图表生成
└── dorsal_intercalation_analysis.py # 核心分析类
```

### 自定义参数

您可以在脚本中调整以下参数：

```python
# 图片质量设置
dpi = 300  # 可调整为600获得更高质量

# 字体大小
axis_label_size = 16    # 轴标签
tick_label_size = 14    # 刻度标签  
legend_size = 12        # 图例
colorbar_size = 14      # 色条

# 颜色方案
cmap = 'viridis'        # 可选: 'plasma', 'inferno', 'magma'
```

### 故障排除

1. **导入错误**: 确保所有依赖包已安装
   ```bash
   pip install numpy matplotlib scipy
   ```

2. **字体警告**: 如果出现字体警告，可忽略或安装Times New Roman字体

3. **内存不足**: 降低DPI值或分批生成图表

4. **路径错误**: 确保在项目根目录执行脚本

---

## 📈 技术细节

### 数据生成原理

所有图表基于科学合理的模拟数据生成：

1. **共关联矩阵**: 基于滑动时间窗口的Jaccard相似性计算
2. **层次聚类**: 使用(1-共关联强度)作为距离度量
3. **统计分析**: 采用非参数检验和效应量计算
4. **时间序列**: 模拟真实发育过程的动力学变化

### 可视化最佳实践

- **高分辨率输出**: 300-600 DPI适合科学发表
- **色彩无障碍**: 使用色盲友好的配色方案  
- **统计严谨性**: 包含置信区间和显著性检验
- **标准化格式**: 遵循科学期刊图表规范

---

## 📚 引用与致谢

本分析工具基于细胞发育生物学的最新研究成果，特别是：

- **背侧嵌入过程**: 基于C. elegans胚胎发育研究
- **肠原基形成**: 参考肠管形态发生的经典文献  
- **共聚类算法**: 采用时间序列聚类的标准方法
- **统计方法**: 遵循生物统计学最佳实践

---

*本文档最后更新: 2025-08-10*  
*生成工具: Claude Code*